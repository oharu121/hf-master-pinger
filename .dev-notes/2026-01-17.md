# Keep-Alive Interval Research & Best Practices

## Research Date: 2025-01-17

---

## Hugging Face Spaces Sleep Behavior

| Tier | Auto-Sleep Timeout |
|------|-------------------|
| Free (cpu-basic) | 48 hours of inactivity |
| Upgraded hardware | Never (by default) |

When a Space sleeps, any visitor accessing it will automatically wake it up.

---

## Industry Best Practices for Keep-Alive Pings

| Platform/Scenario | Recommended Interval |
|-------------------|---------------------|
| AWS Lambda (non-VPC) | Every 5 minutes |
| AWS Lambda (VPC) | Every 15 minutes |
| Azure Functions | Every 2 minutes |
| General serverless | 5-10 minutes |

---

## Space State Definitions

### Hot State (5 min ping)
- All processes loaded in memory
- Caches warm
- Connections active
- Instant response times

### Warm State (15-30 min ping)
- Space running but may have shed cached resources
- Some reconnection needed on first request
- Response: +2-10 seconds on first call

### Cool State (1-6 hour ping)
- Space running but mostly idle
- Caches cleared, connections dropped
- Response: +10-30 seconds on first call

### Just Alive State (24-47 hour ping)
- Technically not sleeping but essentially cold
- Full cold start behavior
- Response: +30 sec - 3 min on first call

---

## Use Case Recommendations

### Discord Bot
| Recommended State | Ping Interval | Notes |
|-------------------|---------------|-------|
| Hot | Every 1-3 min | WebSocket connections drop after ~5 min idle. Bot appears "offline" when disconnected. |

**Critical Issue**: Discord bots require persistent WebSocket connections. Even 5-min pings may not be enough to keep the connection alive. Consider always-on hosting (Railway, Fly.io, VPS).

### n8n Workflow (Webhooks)
| Recommended State | Ping Interval | Notes |
|-------------------|---------------|-------|
| Hot | Every 3-5 min | Webhooks need instant response or external callers timeout (typically 10-30 sec). |

**Critical Issue**: If Space needs to wake up, webhook callers will timeout before receiving response. Consider self-hosted n8n or n8n Cloud for reliable webhooks.

### RAG (Retrieval Augmented Generation)
| Recommended State | Ping Interval | Notes |
|-------------------|---------------|-------|
| Warm | Every 10-15 min | Can tolerate short reload time. Vector DB and embeddings may need reloading (+2-10 sec). |

### LLM Backend (API)
| Recommended State | Ping Interval | Notes |
|-------------------|---------------|-------|
| Warm | Every 10-15 min | Users expect some latency. Model weights may need partial reload (+5-15 sec first inference). |

---

## Summary Table

| Use Case | Required State | Ping Interval | HF Free Tier Viable? |
|----------|---------------|---------------|---------------------|
| Discord Bot | Hot | 1-3 min | Problematic |
| n8n Webhooks | Hot | 3-5 min | Problematic |
| RAG | Warm | 10-15 min | Yes |
| LLM Backend | Warm | 10-15 min | Yes |

---

## Why Not Ping Every 47 Hours?

The 48-hour timeout only prevents **complete shutdown**. However:

1. **Cold Start vs Sleep** - Even if not sleeping, internal resources get cleared:
   - ML models unloaded from memory
   - Cached data cleared
   - Database connections dropped
   - WebSocket connections terminated

2. **Response Time Impact**:
   | Interval | GAS Executions/Day | Typical Response Time |
   |----------|-------------------|----------------------|
   | 5 min | 288 | ~1-2 sec |
   | 30 min | 48 | ~3-5 sec |
   | 6 hours | 4 | ~10-30 sec |
   | 47 hours | ~0.5 | ~30 sec - 2 min |

---

## Alternative Hosting for Always-On Services

| Service | Better Alternatives |
|---------|-------------------|
| Discord Bot | Railway, Fly.io, Render, cheap VPS ($5/mo) |
| n8n Webhooks | Self-hosted n8n, n8n Cloud, Railway |
| RAG/LLM | HF Spaces with appropriate ping interval |

---

## Sources

- [Hugging Face - Manage your Space](https://huggingface.co/docs/huggingface_hub/main/en/guides/manage-spaces)
- [Hugging Face - Spaces Overview](https://huggingface.co/docs/hub/en/spaces-overview)
- [Serverless.com - Keep Your Lambdas Warm](https://www.serverless.com/blog/keep-your-lambdas-warm)
- [Jeremy Daly - Lambda Warmer](https://www.jeremydaly.com/lambda-warmer-optimize-aws-lambda-function-cold-starts/)
- [Wissen - Serverless Cold Starts](https://www.wissen.com/blog/serverless-cold-starts-latency-reducing-strategies)
